# This workflow runs any unit / integration tests and lints the code for styling issues
name: Code testing & linting

# This workflow is triggered when a branch is merged to the main branch
# or a new PR is created on the main branch
on:
  push:
    branches:
      - main
    paths:
      - '${{ github.repository }}/**' # Only triggered when application files are modified  
  pull_request:
    branches:
      - main
    paths:
      - '${{ github.repository }}/**' # Only triggered when application files are modified

jobs:
  # Run unit tests to make sure everything is üëç
  test:
    name: 'Run unit tests'
    # Specify the OS we want the workflow to run on
    runs-on: ubuntu-latest
    # Define the steps for this job
    steps:
    - name: 'Checkout repository'
      uses: actions/checkout@v3

    - name: 'Set up .NET'
      uses: actions/setup-dotnet@v3
      with:
        dotnet-version: 6.0.x # Adjust the version as needed

    - name: 'Restore dependencies'
      run: dotnet restore

    - name: 'Build application'
      run: dotnet build --configuration Release
      
    - name: 'Run Tests'
      run: dotnet test --configuration Release

  # Run the linter to check for code style issues
  lint:
    name: 'Run linter'
    runs-on: ubuntu-latest
    steps:    
    - name: 'Checkout repository'
      uses: actions/checkout@v3
    
    - name: 'Run .NET Linter'
      uses: zyactions/dotnet-lint@v1
      with:
        workspace: ci-cd-demo
        implicit-restore: true
